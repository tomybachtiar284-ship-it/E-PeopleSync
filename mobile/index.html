<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E-PeopleSync Mobile</title>
    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom Style -->
    <link rel="stylesheet" href="../css/mobile.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="mobile-container">
        <!-- Status Bar Simulator (Optional but adds to realism) -->
        <div class="status-bar">
            <span id="currentTime">17:40</span>
            <div class="status-icons">
                <i class="fas fa-signal"></i>
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-full"></i>
            </div>
        </div>

        <!-- Main Content Area (Scrollable) -->
        <div class="main-content" id="mobileMainContent">
            <!-- Home Screen View -->
            <div id="homeView" class="view active">
                <div class="header-wave">
                    <div class="header-content"
                        style="display: flex; align-items: center; justify-content: space-between;">
                        <div class="d-flex align-items-center gap-15">
                            <div style="position: relative;">
                                <img src="https://i.pravatar.cc/150?u=tomy" id="homeProfileImg"
                                    style="width: 50px; height: 50px; border-radius: 50%; border: 2px solid white; object-fit: cover;"
                                    onclick="document.getElementById('avatarUpload').click()">
                                <div
                                    style="position: absolute; bottom: 0; right: 0; background: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: var(--mobile-primary); border: 1px solid #eee;">
                                    <i class="fas fa-camera"></i>
                                </div>
                                <input type="file" id="avatarUpload" accept="image/*" style="display: none;"
                                    onchange="handleAvatarUpload(this)">
                            </div>
                            <div class="greeting-area">
                                <span class="greeting-prefix" style="color: rgba(255,255,255,0.9);">Good
                                    Afternoon,</span>
                                <h2 class="user-name" id="userGreetingName" style="font-size: 18px; margin: 0;">M. Tomy
                                    Bachtiar</h2>
                            </div>
                        </div>
                        <div class="weather-widget">
                            <i class="fas fa-cloud-sun text-warning"></i>
                            <div class="temp">29Â°C</div>
                        </div>
                    </div>
                </div>

                <div class="content-body">
                    <!-- Quick Actions Grid -->
                    <div class="feature-grid">
                        <!-- Absensi Card -->
                        <div class="feature-card card-purple" onclick="navigateTo('attendance')">
                            <div class="icon-box purple">
                                <i class="fas fa-fingerprint"></i>
                            </div>
                            <span class="feature-name">Absensi</span>
                        </div>

                        <!-- Request Leave Card -->
                        <div class="feature-card card-orange" onclick="navigateTo('leave')">
                            <div class="icon-box orange">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <span class="feature-name">Cuti / Izin</span>
                        </div>

                        <!-- Learning Hub Card -->
                        <div class="feature-card card-blue" onclick="navigateTo('learning')">
                            <div class="icon-box blue">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <span class="feature-name">Learning Hub</span>
                        </div>

                        <!-- My Performance Card -->
                        <div class="feature-card card-green" onclick="navigateTo('perform')">
                            <div class="icon-box green">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <span class="feature-name">My Perform</span>
                        </div>
                    </div>

                    <!-- Recent Activity / Promo (Optional) -->
                    <div class="m-card mt-3"
                        style="padding: 15px; display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <h4 style="font-size: 14px; font-weight: 700; margin-bottom: 2px;">Butuh Bantuan HR?</h4>
                            <p style="font-size: 11px; color: #718096;">Chat langsung dengan tim HR via WhatsApp</p>
                        </div>
                        <button
                            style="background: #25D366; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </div>

                </div>
            </div>

            <!-- Stats/Winners View -->
            <div id="statsView" class="view">
                <div class="stats-header">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="view-title">Winners</h2>
                        <div class="header-icons">
                            <i class="fas fa-user-circle"></i>
                            <i class="fas fa-search"></i>
                        </div>
                    </div>

                    <div class="tab-pills">
                        <button class="pill active">Today</button>
                        <button class="pill">Month</button>
                        <button class="pill">All time</button>
                    </div>
                </div>

                <div class="podium-area">
                    <!-- Rank 2 -->
                    <div class="podium-item second">
                        <div class="avatar-ring">
                            <img src="https://i.pravatar.cc/100?u=2" alt="Avatar">
                            <div class="rank-badge">2</div>
                        </div>
                        <div class="podium-name">Budi S.</div>
                        <div class="podium-pts">6500 Pts</div>
                    </div>

                    <!-- Rank 1 -->
                    <div class="podium-item first">
                        <div class="avatar-ring gold">
                            <img src="https://i.pravatar.cc/100?u=12" alt="Avatar">
                            <div class="rank-badge">1</div>
                        </div>
                        <div class="podium-name">Andi S.</div>
                        <div class="podium-pts">7400 Pts</div>
                    </div>

                    <!-- Rank 3 -->
                    <div class="podium-item third">
                        <div class="avatar-ring">
                            <img src="https://i.pravatar.cc/100?u=3" alt="Avatar">
                            <div class="rank-badge">3</div>
                        </div>
                        <div class="podium-name">John Carter</div>
                        <div class="podium-pts">5800 Pts</div>
                    </div>
                </div>

                <div class="rank-list">
                    <div class="rank-item current-user">
                        <span class="rank-num">14</span>
                        <img src="https://i.pravatar.cc/100?u=tomy" class="rank-avatar">
                        <span class="rank-name">TOMY (You)</span>
                        <span class="rank-pts">3684 Pts</span>
                    </div>

                    <div id="rankingListContainer">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Learning View -->
            <div id="learningView" class="view">
                <div class="stats-header">
                    <div class="header-content">
                        <h2 class="view-title">Learning Hub</h2>
                        <div class="header-icons">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                    </div>
                    <div class="tab-pills">
                        <button class="pill active" onclick="filterMobileCourses('all', this)">All</button>
                        <button class="pill" onclick="filterMobileCourses('progress', this)">Progress</button>
                        <button class="pill" onclick="filterMobileCourses('completed', this)">Done</button>
                    </div>
                </div>

                <div class="content-body" style="margin-top: 20px;">
                    <div id="mobileCourseGrid" class="mobile-course-grid">
                        <!-- Course cards here -->
                    </div>
                </div>
            </div>

            <!-- Performance View (My Perform) -->
            <div id="performView" class="view">
                <div class="stats-header">
                    <div class="header-content">
                        <h2 class="view-title">My Perform</h2>
                        <div class="header-icons">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                </div>

                <div class="content-body" style="margin-top: 20px; padding-bottom: 80px;">
                    <!-- Radar Chart Card -->
                    <div class="m-card mb-4"
                        style="background: white; border-radius: 24px; padding: 20px; box-shadow: var(--mobile-card-shadow);">
                        <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 5px;">Radar Kompetensi</h3>
                        <p style="font-size: 12px; color: var(--mobile-gray); margin-bottom: 20px;">Analisis area
                            keahlian profesional Anda</p>
                        <div style="height: 250px; position: relative;">
                            <canvas id="mobileRadarChart"></canvas>
                        </div>
                    </div>

                    <!-- KPI Trend Card -->
                    <div class="m-card mb-4"
                        style="background: white; border-radius: 24px; padding: 20px; box-shadow: var(--mobile-card-shadow);">
                        <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 5px;">Tren Skor KPI</h3>
                        <p style="font-size: 12px; color: var(--mobile-gray); margin-bottom: 20px;">Perkembangan
                            performa 6 bulan terakhir</p>
                        <div style="height: 180px; position: relative;">
                            <canvas id="mobileHistoryChart"></canvas>
                        </div>
                    </div>

                    <!-- Objectives Card -->
                    <div class="m-card mb-4"
                        style="background: white; border-radius: 24px; padding: 20px; box-shadow: var(--mobile-card-shadow);">
                        <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 15px;">Target & Objektif</h3>
                        <div id="mobileObjectivesList">
                            <!-- Objectives rendered here -->
                        </div>
                    </div>

                    <!-- Feedback Card -->
                    <div class="m-card"
                        style="background: #fff3e0; border-radius: 24px; padding: 20px; border-left: 5px solid #ef6c00;">
                        <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 10px; color: #e65100;">Feedback
                            Atasan</h3>
                        <div id="mobileFeedbackArea">
                            <!-- Feedback rendered here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications View -->
            <div id="notificationsView" class="view">
                <div class="stats-header">
                    <div class="header-content">
                        <h2 class="view-title">Notifications</h2>
                        <div class="header-icons">
                            <i class="fas fa-check-double" onclick="markAllNotificationsRead()"
                                style="font-size: 18px; cursor: pointer;"></i>
                        </div>
                    </div>
                </div>

                <div class="content-body" style="margin-top: 20px; padding-bottom: 80px;">
                    <div id="mobileNotificationsList" class="notif-list">
                        <!-- Notifications rendered here -->
                    </div>

                    <div id="emptyNotifState" style="display: none; text-align: center; padding: 100px 20px;">
                        <i class="fas fa-bell-slash" style="font-size: 50px; color: #cbd5e0; margin-bottom: 20px;"></i>
                        <p style="color: #a0aec0;">Tidak ada notifikasi baru.</p>
                    </div>
                </div>
            </div>

            <!-- News View -->
            <div id="newsView" class="view">
                <div class="stats-header">
                    <div class="header-content">
                        <h2 class="view-title">Company News</h2>
                        <div class="header-icons">
                            <i class="fas fa-newspaper"></i>
                        </div>
                    </div>
                </div>

                <div class="content-body" style="margin-top: 20px; padding-bottom: 80px;">
                    <div id="news-list-vertical" class="news-list-vertical">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- History View -->
            <div id="historyView" class="view">
                <div class="view-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>Riwayat Aktivitas</h3>
                    <input type="month" id="historyFilterMonth" class="mobile-input"
                        style="width: auto; padding: 5px 10px; font-size: 12px; margin: 0;"
                        onchange="renderMobileHistory()">
                </div>

                <div class="history-tabs">
                    <div class="hist-tab active" onclick="renderMobileHistory('attendance', this)">Absensi</div>
                    <div class="hist-tab" onclick="renderMobileHistory('leaves', this)">Cuti / Izin</div>
                </div>

                <!-- Leave Summary Panel (Visible only on Leaves tab) -->
                <div id="leaveSummaryPanel" class="feature-grid"
                    style="display: none; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px 0;">
                    <div class="m-card"
                        style="padding: 15px; display: flex; align-items: center; gap: 10px; border-left: 4px solid #FF9B6A;">
                        <i class="fas fa-calendar-check" style="font-size: 20px; color: #FF9B6A;"></i>
                        <div>
                            <span style="font-size: 10px; color: #888; display: block;">Cuti Tahunan</span>
                            <strong id="summaryCuti" style="font-size: 16px; color: #2D3436;">0</strong>
                        </div>
                    </div>
                    <div class="m-card"
                        style="padding: 15px; display: flex; align-items: center; gap: 10px; border-left: 4px solid #0984E3;">
                        <i class="fas fa-info-circle" style="font-size: 20px; color: #0984E3;"></i>
                        <div>
                            <span style="font-size: 10px; color: #888; display: block;">Izin Pribadi</span>
                            <strong id="summaryIzin" style="font-size: 16px; color: #2D3436;">0</strong>
                        </div>
                    </div>
                    <div class="m-card"
                        style="padding: 15px; display: flex; align-items: center; gap: 10px; border-left: 4px solid #D63031;">
                        <i class="fas fa-procedures" style="font-size: 20px; color: #D63031;"></i>
                        <div>
                            <span style="font-size: 10px; color: #888; display: block;">Sakit</span>
                            <strong id="summarySakit" style="font-size: 16px; color: #2D3436;">0</strong>
                        </div>
                    </div>
                    <div class="m-card"
                        style="padding: 15px; display: flex; align-items: center; gap: 10px; border-left: 4px solid #6C5CE7;">
                        <i class="fas fa-briefcase" style="font-size: 20px; color: #6C5CE7;"></i>
                        <div>
                            <span style="font-size: 10px; color: #888; display: block;">Dinas Luar</span>
                            <strong id="summaryDL" style="font-size: 16px; color: #2D3436;">0</strong>
                        </div>
                    </div>
                </div>

                <div id="mobileHistoryList" class="history-list">
                    <!-- History items will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Bottom Navigation Bar -->
        <nav class="bottom-nav">
            <div class="nav-item active" onclick="switchView('home', this)">
                <i class="fas fa-home"></i>
            </div>
            <div class="nav-item" onclick="switchView('learning', this)">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <div class="nav-item profile-item" onclick="switchView('news', this)">
                <img src="https://i.pravatar.cc/100?u=tomy" id="navAvatar" alt="News">
                <div class="nav-center-label">News</div>
            </div>
            <div class="nav-item" onclick="switchView('perform', this)">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="nav-item" onclick="switchView('history', this)">
                <i class="fas fa-history"></i>
            </div>
            <div class="nav-item" onclick="switchView('notifications', this)">
                <i class="fas fa-bell"></i>
                <span class="notif-dot"></span>
            </div>
        </nav>
    </div>

    <!-- Course Detail Modal -->
    <div id="courseDetailModal" class="mobile-modal">
        <div class="modal-content" style="padding-top: 20px; height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 class="modal-title" id="mobileCourseTitle">Judul Kursus</h3>
                <i class="fas fa-times close-modal" onclick="closeModal('courseDetailModal')"></i>
            </div>

            <div id="mobileMaterialContainer">
                <!-- Course content rendered here -->
            </div>

            <div id="mobileQuizArea" style="display: none;">
                <!-- Quiz area here -->
            </div>

            <div id="mobileCertificateArea" style="display: none; text-align: center; padding: 30px 0;">
                <i class="fas fa-award text-success" style="font-size: 60px; margin-bottom: 20px;"></i>
                <h3>Selamat!</h3>
                <p>Anda telah menyelesaikan kursus ini.</p>
                <button class="btn-clock btn-in" onclick="downloadCertificate()">
                    <i class="fas fa-download"></i> Unduh Sertifikat
                </button>
            </div>

            <div class="action-footer" id="mobileCourseFooter" style="margin-top: 30px;">
                <button id="btnStartQuizMobile" class="btn-clock btn-in" onclick="startQuizMobile()"
                    style="display: none;">
                    <i class="fas fa-edit"></i> Kerjakan Kuis
                </button>
            </div>
        </div>
    </div>

    <!-- Modals (Borrowed from Desktop for functionality) -->
    <!-- Clock In Modal -->
    <div id="clockModal" class="mobile-modal">
        <!-- Content will be handled by mobile.js -->
    </div>

    <!-- Attendance Modal -->
    <div id="attendanceModal" class="mobile-modal bottom-sheet">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Absensi Kehadiran</h3>
                <i class="fas fa-times close-modal" onclick="closeModal('attendanceModal')"></i>
            </div>

            <div class="attendance-card">
                <span class="att-time" id="modalTime">17:48</span>
                <span class="att-date" id="modalDate">Selasa, 17 Feb 2026</span>
                <div id="attendanceStatus" class="status-badge"
                    style="font-size: 13px; font-weight: 600; color: #00B894;">
                    Status: Belum Absen
                </div>
            </div>

            <div class="action-buttons">
                <button id="btnClockIn" class="btn-clock btn-in" onclick="processClock('In')">
                    <i class="fas fa-sign-in-alt"></i> Clock In Sekarang
                </button>
                <button id="btnClockOut" class="btn-clock btn-out" onclick="processClock('Out')" disabled>
                    <i class="fas fa-sign-out-alt"></i> Clock Out Sekarang
                </button>
            </div>

            <div class="notif-banner">
                <i class="fas fa-info-circle"></i>
                <span>Pastikan lokasi GPS aktif sebelum melakukan absensi.</span>
            </div>
        </div>
    </div>

    <!-- Leave Request Modal -->
    <div id="leaveModal" class="mobile-modal bottom-sheet">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Pengajuan Cuti / Izin</h3>
                <i class="fas fa-times close-modal" onclick="closeModal('leaveModal')"></i>
            </div>

            <form id="leaveForm" onsubmit="submitLeaveRequest(event)">
                <div class="form-group mb-3">
                    <label class="form-label">Jenis Keperluan</label>
                    <select id="leaveType" class="mobile-input" required>
                        <option value="">Pilih Jenis...</option>
                        <option value="Cuti Tahunan">Cuti Tahunan</option>
                        <option value="Sakit">Izin Sakit (Medical)</option>
                        <option value="Izin">Izin Keperluan Mendesak</option>
                        <option value="Dinas Luar">Dinas Luar (DL)</option>
                        <option value="Setengah Hari">Izin Setengah Hari</option>
                    </select>
                </div>

                <div class="d-grid-2 gap-15 mb-3">
                    <div class="form-group">
                        <label class="form-label">Dari Tanggal</label>
                        <input type="date" id="leaveStartDate" class="mobile-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sampai Tanggal</label>
                        <input type="date" id="leaveEndDate" class="mobile-input" required>
                    </div>
                </div>

                <div class="form-group mb-4">
                    <label class="form-label">Alasan / Keterangan</label>
                    <textarea id="leaveReason" class="mobile-input" rows="3" placeholder="Tulis alasan singkat..."
                        required></textarea>
                </div>

                <!-- Team Leader Section -->
                <div class="form-group mb-2">
                    <label class="form-label"
                        style="border-bottom: 1px solid #eee; padding-bottom: 5px; width:100%; font-weight:700; color: #555;">Mengetahui
                        (Team Leader)</label>
                </div>
                <div class="d-grid-2 gap-15 mb-3">
                    <div class="form-group">
                        <label class="form-label" style="font-size:11px;">Nama</label>
                        <select id="reqSupervisorMobile" class="mobile-input"
                            onchange="autoFillPositionMobile('supervisor')" required>
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="font-size:11px;">Jabatan</label>
                        <input type="text" id="reqSupervisorPositionMobile" class="mobile-input" readonly
                            style="background: #f5f5f5; color:#888;">
                    </div>
                </div>

                <!-- ASMAN Section -->
                <div class="form-group mb-2">
                    <label class="form-label"
                        style="border-bottom: 1px solid #eee; padding-bottom: 5px; width:100%; font-weight:700; color: #555;">Disetujui
                        (ASMAN)</label>
                </div>
                <div class="d-grid-2 gap-15 mb-4">
                    <div class="form-group">
                        <label class="form-label" style="font-size:11px;">Nama</label>
                        <select id="reqManagerMobile" class="mobile-input" onchange="autoFillPositionMobile('manager')"
                            required>
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="font-size:11px;">Jabatan</label>
                        <input type="text" id="reqManagerPositionMobile" class="mobile-input" readonly
                            style="background: #f5f5f5; color:#888;">
                    </div>
                </div>

                <button type="submit" class="btn-clock btn-in">
                    <i class="fas fa-paper-plane"></i> Kirim Pengajuan
                </button>
            </form>

            <div class="notif-banner" style="background: #fff3e0; color: #e65100;">
                <i class="fas fa-info-circle"></i>
                <span>Pengajuan akan diteruskan ke Team Leader & ASMAN melalui approval sistem.</span>
            </div>
        </div>
    </div>

    <!-- Trial Link Popup (Floating) -->
    <div id="trialLinkPopup"
        style="display: none; position: fixed; bottom: 100px; left: 20px; right: 20px; background: #fff; border: 2px solid var(--premium-emerald); border-radius: 15px; padding: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 9999; animation: slideUp 0.3s ease-out;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
            <strong style="color: var(--premium-emerald); font-size: 14px;"><i class="fas fa-flask"></i> Trial: Link
                Persetujuan</strong>
            <i class="fas fa-times" onclick="this.parentElement.parentElement.style.display='none'"
                style="color: #ccc; cursor: pointer;"></i>
        </div>
        <p style="font-size: 12px; color: #666; margin-bottom: 10px;">Gunakan link ini untuk mencoba alur persetujuan
            sebagai atasan:</p>
        <a id="trialLinkHref" href="#"
            style="display: block; background: #f0fdf4; color: #166534; padding: 10px; border-radius: 8px; font-size: 11px; word-break: break-all; text-decoration: none; border: 1px solid #bbf7d0;">
            -
        </a>
        <div style="margin-top: 10px; font-size: 10px; color: #888;">Klik link di atas untuk bertindak sebagai Atasan.
        </div>
    </div>

    <style>
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>

    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script src="../js/utils.js"></script>
    <script src="../js/mobile.js"></script>
    <script src="../js/receipt.js"></script>
</body>

</html>